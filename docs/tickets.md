# Hondana - 開発チケット一覧

## 概要

MVP機能を8つのフェーズに分割。各フェーズ内のチケットは上から順に着手することを推奨。
フェーズ間の依存関係: **0 → 1 → 2, 3（並行可） → 4 → 5 → 6 → 7 → 8**

---

## Phase 0: プロジェクト基盤整備

このフェーズではSupabaseの接続設定、UIライブラリの導入、全画面共通のレイアウトを構築する。

### #001 Supabase プロジェクトセットアップ

**種別:** 環境構築

- Supabaseプロジェクト作成
- `@supabase/supabase-js` / `@supabase/ssr` のインストール
- 環境変数の設定（`.env.local` に `SUPABASE_URL`, `SUPABASE_ANON_KEY`）
- Supabaseクライアントユーティリティの作成（`lib/supabase/client.ts`, `lib/supabase/server.ts`）
- DB テーブル作成（`database_design.md` のSQL実行: users, books, user_books, reviews, follows + RLSポリシー + トリガー）

**完了条件:** Supabaseに接続できること。全テーブル・RLSポリシー・トリガーが作成済み。

---

### #002 shadcn/ui 導入

**種別:** 環境構築

- shadcn/ui のセットアップ（`npx shadcn@latest init`）
- 基本コンポーネントの追加: Button, Input, Label, Card, Avatar, Badge, Tabs, Dialog, DropdownMenu, Skeleton, Toast(Sonner)
- テーマカラーの設定（読書アプリにふさわしい落ち着いたカラーパレット）

**完了条件:** shadcn/uiコンポーネントがインポートして使える状態。

---

### #003 共通レイアウト（ヘッダー・フッター）

**種別:** UI実装
**依存:** #002

- `app/layout.tsx` にヘッダー・フッターを配置
- **ヘッダー:**
  - ロゴ（`/` へのリンク）
  - 書籍検索バー（UI のみ、検索機能は #013 で実装）
  - 未認証時: ログイン / 新規登録ボタン
  - 認証済み時: マイページアイコン、ログアウトボタン
  - ※認証状態の切り替えは #006 完了後に接続
- **フッター:** コピーライト
- レスポンシブ対応（モバイルではハンバーガーメニュー等）

**完了条件:** 全ページにヘッダー・フッターが表示される。レスポンシブで崩れない。

---

## Phase 1: 認証機能

### #004 新規登録画面

**種別:** 機能実装
**依存:** #001, #002

- `/signup` ページの作成
- フォーム: ユーザー名、メールアドレス、パスワード、パスワード確認
- バリデーション（空欄チェック、メール形式、パスワード一致、パスワード強度）
- Supabase Auth `signUp` の呼び出し
- 登録成功時に `users` テーブルにプロフィールレコード作成（username を保存）
- 登録成功後、トップページへリダイレクト
- ログイン画面へのリンク

**完了条件:** 新規ユーザーがアカウントを作成でき、`auth.users` と `public.users` の両方にレコードが作られる。

---

### #005 ログイン画面

**種別:** 機能実装
**依存:** #001, #002

- `/login` ページの作成
- フォーム: メールアドレス、パスワード
- バリデーション
- Supabase Auth `signInWithPassword` の呼び出し
- ログイン成功後、トップページ（またはリダイレクト元）へ遷移
- 新規登録画面へのリンク
- エラー表示（認証失敗時）

**完了条件:** 登録済みユーザーがログインでき、セッションが確立される。

---

### #006 認証状態管理・ミドルウェア

**種別:** 機能実装
**依存:** #004, #005

- 認証状態を管理する仕組みの実装（Supabase SSR のセッション管理）
- Next.js Middleware (`middleware.ts`) で認証必須ページのガード
  - 未認証で `/mypage/*` 等にアクセスした場合、`/login` にリダイレクト
  - リダイレクト元のURLをクエリパラメータで保持
- ヘッダーの認証状態切り替えを接続（#003 のヘッダーと連携）
- ログアウト機能の実装

**完了条件:** 認証必須ページへの未認証アクセスがガードされる。ヘッダーが認証状態に応じて切り替わる。ログアウトが機能する。

---

## Phase 2: ユーザープロフィール

### #007 マイページ（プロフィール表示）

**種別:** 機能実装
**依存:** #006

- `/mypage` ページの作成
- ログインユーザーのプロフィール表示（ユーザー名、プロフィール画像、自己紹介）
- フォロー数 / フォロワー数の表示（数値のみ、リンクは #024 で実装）
- プロフィール編集ボタン
- タブUI（本棚 / レビュー）の枠だけ作成（中身は後のフェーズで実装）

**完了条件:** ログインユーザーの基本情報がマイページに表示される。

---

### #008 プロフィール編集画面

**種別:** 機能実装
**依存:** #007

- `/mypage/edit` ページの作成
- フォーム: ユーザー名、自己紹介
- プロフィール画像アップロード（Supabase Storage使用）
  - 画像プレビュー
  - ファイルサイズ・形式バリデーション
- `users` テーブルの更新
- 保存成功後、マイページへリダイレクト

**完了条件:** ユーザーが自分のプロフィール情報を編集・保存でき、アバター画像がアップロードできる。

---

## Phase 3: 書籍検索・登録（Phase 2 と並行可）

### #009 書籍検索 API Route

**種別:** 機能実装
**依存:** #001

- Google Books API（または OpenBD）を呼び出す API Route の作成（`app/api/books/search/route.ts`）
- クエリパラメータ: `q`（検索キーワード）
- レスポンス: 書籍リスト（タイトル、著者、ISBN、表紙画像URL、出版社、出版日）
- エラーハンドリング（APIエラー、レート制限）
- 型定義（`types/book.ts` 等）

**完了条件:** `/api/books/search?q=キーワード` で書籍検索結果が返る。

---

### #010 トップページ（検索UI）

**種別:** 機能実装
**依存:** #003, #009

- `/` ページの実装
- 検索バーからの書籍検索機能
- 検索結果の表示（書籍カード: 表紙画像、タイトル、著者）
- 書籍カードクリックで書籍詳細画面へ遷移
- 検索中のローディング表示
- 未認証でも利用可能

**完了条件:** トップページで書籍を検索でき、結果が一覧表示される。

---

### #011 書籍詳細画面（基本情報）

**種別:** 機能実装
**依存:** #009

- `/books/[id]` ページの作成
- 書籍の基本情報表示（表紙画像、タイトル、著者、出版社、出版日、ISBN）
- URLの `[id]` はDB上の books.id（UUID）
- 書籍データがDBに未登録の場合は外部APIから取得してDBに保存
- 未認証でも閲覧可能
- レビュー一覧セクションの枠だけ作成（中身は #019 で実装）

**完了条件:** 書籍詳細ページで本の基本情報が表示される。

---

### #012 本棚に追加機能

**種別:** 機能実装
**依存:** #006, #011

- 書籍詳細画面に「本棚に追加」ボタンを配置
- ボタンクリックでモーダル表示
  - ステータス選択（読みたい / 読書中 / 読了 / 積読）
  - 星評価選択（任意）
- `user_books` テーブルへの保存
- 既に追加済みの場合はボタンを「登録済み」に変更し、ステータス変更・削除を可能にする
- 未認証の場合はログインを促す

**完了条件:** ログインユーザーが書籍を自分の本棚に追加でき、ステータスと評価を設定できる。

---

## Phase 4: 読書記録管理

### #013 マイページ - 本棚

**種別:** 機能実装
**依存:** #007, #012

- `/mypage/bookshelf` ページの作成（またはマイページのタブ内として実装）
- 登録済み書籍の一覧表示（表紙画像、タイトル、著者、ステータス、評価）
- フィルター: すべて / 読みたい / 読書中 / 読了 / 積読
- 各書籍のステータス変更・評価変更機能
- 書籍クリックで書籍詳細画面へ遷移
- レビューを書く / 編集ボタン（遷移先は #017, #018 で実装）

**完了条件:** 自分の本棚が表示され、ステータス別フィルタリングが動作する。

---

### #014 読書統計表示

**種別:** 機能実装
**依存:** #013

- マイページに統計情報を追加
  - 読了数
  - 平均評価
  - ステータス別冊数

**完了条件:** マイページに読書統計が表示される。

---

## Phase 5: レビュー機能

### #015 レビュー投稿画面

**種別:** 機能実装
**依存:** #012

- `/books/[id]/review/new` ページの作成
- 書籍情報の表示（タイトル、表紙画像）
- フォーム: 星評価選択（1〜5）、レビュー本文（テキストエリア、最大5000文字）
- `reviews` テーブルへの保存、`user_books.rating` の更新
- 投稿成功後、書籍詳細画面へリダイレクト
- 前提チェック: 本棚に未登録の場合は登録を促す

**完了条件:** 本棚登録済みの書籍に対してレビューを投稿できる。

---

### #016 レビュー編集・削除画面

**種別:** 機能実装
**依存:** #015

- `/books/[id]/review/edit` ページの作成
- 既存のレビュー内容を初期値としてフォーム表示
- 更新機能
- 削除機能（確認ダイアログ付き）
- 自分のレビューのみ編集・削除可能（権限チェック）

**完了条件:** 自分のレビューを編集・削除できる。

---

### #017 書籍詳細画面 - レビュー一覧表示

**種別:** 機能実装
**依存:** #015

- 書籍詳細画面（#011）にレビュー一覧を追加
- 各レビュー: ユーザー名、アバター、投稿日時、星評価、本文
- 平均評価・レビュー数の表示
- 「レビューを書く」ボタン（認証済み & 本棚登録済みの場合）
- この時点ではフォロー制御なし（全文表示）。プレビュー制御は #023 で追加

**完了条件:** 書籍詳細画面にレビュー一覧と平均評価が表示される。

---

### #018 マイページ - レビュー一覧

**種別:** 機能実装
**依存:** #015

- `/mypage/reviews` ページの作成（またはマイページのタブ内として実装）
- 自分が投稿したレビューの一覧表示
- 各レビュー: 書籍の表紙・タイトル、投稿日時、星評価、本文
- 編集ボタン → レビュー編集画面へ遷移

**完了条件:** 自分のレビュー一覧が表示され、編集画面へ遷移できる。

---

## Phase 6: フォロー機能

### #019 フォロー・フォロー解除 API

**種別:** 機能実装
**依存:** #006

- フォロー・フォロー解除の Server Action または API Route
- `follows` テーブルへの INSERT / DELETE
- フォロー状態チェック用の関数
- 自分自身のフォロー防止

**完了条件:** フォロー・フォロー解除がDB上で正しく動作する。

---

### #020 フォローボタンコンポーネント

**種別:** UI実装
**依存:** #019

- 再利用可能なフォローボタンコンポーネントの作成
- 状態: 「フォローする」/「フォロー中」の切り替え
- クリックで即座にフォロー状態を反映（Optimistic UI）
- 未認証の場合はログインを促す

**完了条件:** フォローボタンが各所（書籍詳細、ユーザーページ等）で使い回せる。

---

### #021 レビュー表示のフォロー制御

**種別:** 機能実装
**依存:** #017, #020

- 書籍詳細画面のレビュー一覧にフォロー制御を追加
  - フォロー中のユーザーのレビュー → 全文表示
  - 未フォローのユーザーのレビュー → 最初の100文字 + 「続きを読むにはフォローが必要です」
- 各レビューにフォローボタンを配置

**完了条件:** フォロー状態に応じてレビューの全文/プレビューが切り替わる。

---

### #022 フォロー一覧・フォロワー一覧画面

**種別:** 機能実装
**依存:** #020

- `/mypage/following` ページの作成
  - フォロー中ユーザー一覧（アバター、ユーザー名、フォロー解除ボタン）
- `/mypage/followers` ページの作成
  - フォロワー一覧（アバター、ユーザー名、フォローバック状態、フォローボタン）
- マイページのフォロー数 / フォロワー数からのリンク接続

**完了条件:** フォロー・フォロワー一覧が表示され、フォロー操作ができる。

---

## Phase 7: ユーザーページ

### #023 ユーザーページ

**種別:** 機能実装
**依存:** #020, #021

- `/users/[id]` ページの作成
- プロフィール表示（ユーザー名、アバター、自己紹介、フォロー数/フォロワー数）
- フォローボタン
- タブ: 本棚 / レビュー
- **本棚タブ:**
  - 未フォロー: 最新の登録本を数件のみ表示
  - フォロー中: 全ての本棚を表示
- **レビュータブ:**
  - 未フォロー: 最新レビュー1件のプレビューのみ
  - フォロー中: 全レビュー閲覧可能
- 未認証でも閲覧可能（コンテンツは制限される）

**完了条件:** 他ユーザーのページが表示され、フォロー状態に応じたコンテンツ制御が動作する。

---

## Phase 8: トップページ充実・仕上げ

### #024 トップページ - 人気の本 & 最新レビュー

**種別:** 機能実装
**依存:** #017, #023

- トップページに以下セクションを追加:
  - **人気の本ランキング**（評価の高い本、レビュー数の多い本）
  - **最新レビュー**（ユーザー名、本のタイトル、レビュープレビュー）
- レビュー内のユーザー名クリック → ユーザーページへ遷移

**完了条件:** トップページにおすすめコンテンツが表示される。

---

### #025 エラーハンドリング・UX改善

**種別:** 改善
**依存:** 全チケット

- 404ページ（`app/not-found.tsx`）
- エラーページ（`app/error.tsx`）
- ローディング状態の統一（Skeleton / Suspense）
- トースト通知の統一（操作成功・失敗時）
- フォームのアクセシビリティ改善
- レスポンシブデザインの最終調整

**完了条件:** エラー時に適切なフィードバックが表示される。ローディング状態が統一されている。

---

## チケット依存関係の概要

```
Phase 0: #001 → #002 → #003
Phase 1: #004, #005 → #006
Phase 2: #006 → #007 → #008
Phase 3: #001 → #009 → #010, #011 → #012
Phase 4: #012 → #013 → #014
Phase 5: #012 → #015 → #016, #017, #018
Phase 6: #006 → #019 → #020 → #021, #022
Phase 7: #020 + #021 → #023
Phase 8: #017 + #023 → #024 → #025
```

**並行作業可能な組み合わせ:**
- Phase 2（プロフィール）と Phase 3（書籍検索）は #006 完了後に並行可能
- #004 と #005 は並行可能
- #010 と #011 は並行可能
- #016, #017, #018 は #015 完了後に並行可能
- #021 と #022 は並行可能

---

## 追加課題

### #026 書籍検索結果の表示件数・NDL連携の改善

**種別:** バグ修正 / 改善
**依存:** #010

- NDL Search API + OpenBD を併用する検索を導入したが、検索結果が20件以上表示されない問題がある
- 原因の調査と修正が必要:
  - フロントエンド側の表示件数制限の有無を確認
  - NDL Search API のレスポンスが正しくパースされているか確認
  - Google Books と NDL のマージ処理でデータが欠落していないか確認
  - fetch のキャッシュ（`revalidate: 300`）が古い結果を返していないか確認
- 必要に応じてページネーション対応も検討

**完了条件:** 日本語キーワードで検索した際に、Google Books + NDL の両方から取得した結果がマージされて20件以上表示される。

---

**作成日**: 2026年2月10日
**バージョン**: 1.0
